{% extends "base.html" %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h3 class="text-center">Editar Empleado: {{ empleado.nombre }} {{ empleado.apellido_paterno }}</h3>
            </div>
            <div class="card-body">
                <form method="POST" action="{{ url_for('empleados.edit_empleado', id=empleado.id) }}"id="empleadoForm">
                    {{ form.hidden_tag() }}
                    
                    <!-- Agregar campo teléfono -->
                        <div class="row mb-3">
                            <div class="col-md-6">
                                {{ form.telefono.label(class="form-label") }}
                                {{ form.telefono(class="form-control", placeholder="10 dígitos") }}
                                {% for error in form.telefono.errors %}
                                <span class="text-danger">{{ error }}</span>
                                {% endfor %}
                            </div>
                        </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-4">
                            {{ form.nombre.label(class="form-label") }}
                            {{ form.nombre(class="form-control text-uppercase", id="nombre-input", style="text-transform:uppercase;") }}
                            {% for error in form.nombre.errors %}
                            <span class="text-danger">{{ error }}</span>
                            {% endfor %}
                        </div>
                        <div class="col-md-4">
                            {{ form.apellido_paterno.label(class="form-label") }}
                            {{ form.apellido_paterno(class="form-control text-uppercase", id="apellido-paterno-input", style="text-transform:uppercase;") }}
                            {% for error in form.apellido_paterno.errors %}
                            <span class="text-danger">{{ error }}</span>
                            {% endfor %}
                        </div>
                        <div class="col-md-4">
                            {{ form.apellido_materno.label(class="form-label") }}
                            {{ form.apellido_materno(class="form-control text-uppercase", id="apellido-materno-input", style="text-transform:uppercase;") }}
{% block scripts %}
{{ super() }}
<script>
    function toUpperCaseInput(e) {
        e.target.value = e.target.value.toUpperCase();
    }
    document.addEventListener('DOMContentLoaded', function() {
        document.getElementById('nombre-input').addEventListener('input', toUpperCaseInput);
        document.getElementById('apellido-paterno-input').addEventListener('input', toUpperCaseInput);
        document.getElementById('apellido-materno-input').addEventListener('input', toUpperCaseInput);
    });
</script>
{% endblock %}
                            {% for error in form.apellido_materno.errors %}
                            <span class="text-danger">{{ error }}</span>
                            {% endfor %}
                        </div>
                    </div>
                    

                    <div class="row mb-3">
                        <div class="col-md-4">
                            {{ form.fecha_nacimiento.label(class="form-label") }}
                            {{ form.fecha_nacimiento(class="form-control", type="date") }}
                            {% for error in form.fecha_nacimiento.errors %}
                            <span class="text-danger">{{ error }}</span>
                            {% endfor %}
                        </div>
                        <div class="col-md-4">
                            {{ form.fecha_ingreso.label(class="form-label") }}
                            {{ form.fecha_ingreso(class="form-control", type="date") }}
                            {% for error in form.fecha_ingreso.errors %}
                            <span class="text-danger">{{ error }}</span>
                            {% endfor %}
                        </div>
                        <div class="col-md-4">
                            {{ form.sexo.label(class="form-label") }}
                            {{ form.sexo(class="form-select") }}
                            {% for error in form.sexo.errors %}
                            <span class="text-danger">{{ error }}</span>
                            {% endfor %}
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            {{ form.puesto.label(class="form-label") }}
                            {{ form.puesto(class="form-select") }}
                            {% for error in form.puesto.errors %}
                            <span class="text-danger">{{ error }}</span>
                            {% endfor %}
                        </div>
                        <div class="col-md-6">
                            <div class="form-check mt-4 pt-3">
                                {{ form.es_supervisor(class="form-check-input") }}
                                {{ form.es_supervisor.label(class="form-check-label") }}
                            </div>
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            {{ form.estatus.label(class="form-label") }}
                            {{ form.estatus(class="form-select") }}
                            {% for error in form.estatus.errors %}
                            <span class="text-danger">{{ error }}</span>
                            {% endfor %}
                        </div>
                        <div class="col-md-6">
                            {{ form.supervisor_id.label(class="form-label") }}
                            {{ form.supervisor_id(class="form-select") }}
                            {% for error in form.supervisor_id.errors %}
                            <span class="text-danger">{{ error }}</span>
                            {% endfor %}
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            {{ form.username.label(class="form-label") }}
                            {{ form.username(class="form-control") }}
                            {% for error in form.username.errors %}
                            <span class="text-danger">{{ error }}</span>
                            {% endfor %}
                        </div>
                        <div class="col-md-6">
                            <div class="form-check mt-4 pt-3">
                                {{ form.reset_password(class="form-check-input") }}
                                {{ form.reset_password.label(class="form-check-label") }}
                            </div>
                        </div>
                    </div>
                    

                    <div class="row mb-3" id="password-fields" style="display: none;">
    <div class="col-md-6">
        {{ form.password.label(class="form-label") }}
        {{ form.password(class="form-control") }}
        {% for error in form.password.errors %}
        <span class="text-danger">{{ error }}</span>
        {% endfor %}
    </div>
    <div class="col-md-6">
        {{ form.password2.label(class="form-label") }}
        {{ form.password2(class="form-control") }}
        {% for error in form.password2.errors %}
        <span class="text-danger">{{ error }}</span>
        {% endfor %}
    </div>
</div>
                    
                    
                    <link rel="stylesheet" href="{{ url_for('static', filename='css/empleados.css') }}">
                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                        <a href="{{ url_for('empleados.list_empleados') }}" class="btn btn-cancel-red">
                            <i class="bi bi-x-lg"></i> Cancelar
                        </a>
                        <button type="submit" class="btn btn-navy me-2" id="submitBtn">Actualizar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const resetPasswordCheckbox = document.getElementById('{{ form.reset_password.id }}');
    const passwordFields = document.getElementById('password-fields');
    
    if (resetPasswordCheckbox && passwordFields) {
        resetPasswordCheckbox.addEventListener('change', function() {
            passwordFields.style.display = this.checked ? 'block' : 'none';
            
            // Hacer requeridos los campos solo si está marcado
            document.getElementById('{{ form.password.id }}').required = this.checked;
            document.getElementById('{{ form.password2.id }}').required = this.checked;
        });
        
        // Estado inicial
        passwordFields.style.display = resetPasswordCheckbox.checked ? 'block' : 'none';
        document.getElementById('{{ form.password.id }}').required = resetPasswordCheckbox.checked;
        document.getElementById('{{ form.password2.id }}').required = resetPasswordCheckbox.checked;
    }
});
</script>
{% endblock %}