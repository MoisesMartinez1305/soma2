{% extends "base.html" %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h3 class="text-center">Crear Nuevo Empleado</h3>
            </div>
            <div class="card-body">
                <form method="POST" action="{{ url_for('empleados.create_empleado') }}">
                    {{ form.hidden_tag() }}
                    
                    <!-- Agregar campo teléfono -->
                        <div class="row mb-3">
                            <div class="col-md-6">
                                {{ form.telefono.label(class="form-label") }}
                                {{ form.telefono(class="form-control", placeholder="10 dígitos") }}
                                {% for error in form.telefono.errors %}
                                <span class="text-danger">{{ error }}</span>
                                {% endfor %}
                            </div>
                        </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-4">
                            {{ form.nombre.label(class="form-label") }}
                            {{ form.nombre(class="form-control", id="nombre-input") }}
                            {% for error in form.nombre.errors %}
                            <span class="text-danger">{{ error }}</span>
                            {% endfor %}
                        </div>
                        <div class="col-md-4">
                            {{ form.apellido_paterno.label(class="form-label") }}
                            {{ form.apellido_paterno(class="form-control", id="apellido-paterno-input") }}
                            {% for error in form.apellido_paterno.errors %}
                            <span class="text-danger">{{ error }}</span>
                            {% endfor %}
                        </div>
                        <div class="col-md-4">
                            {{ form.apellido_materno.label(class="form-label") }}
                            {{ form.apellido_materno(class="form-control", id="apellido-materno-input") }}
                            {% for error in form.apellido_materno.errors %}
                            <span class="text-danger">{{ error }}</span>
                            {% endfor %}
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            {{ form.fecha_nacimiento.label(class="form-label") }}
                            {{ form.fecha_nacimiento(class="form-control", id="fecha-nacimiento-input", type="date") }}
                            {% for error in form.fecha_nacimiento.errors %}
                            <span class="text-danger">{{ error }}</span>
                            {% endfor %}
                        </div>
                        <div class="col-md-6">
                            {{ form.fecha_ingreso.label(class="form-label") }}
                            {{ form.fecha_ingreso(class="form-control", type="date") }}
                            {% for error in form.fecha_ingreso.errors %}
                            <span class="text-danger">{{ error }}</span>
                            {% endfor %}
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            {{ form.puesto.label(class="form-label") }}
                            {{ form.puesto(class="form-select") }}
                            {% for error in form.puesto.errors %}
                            <span class="text-danger">{{ error }}</span>
                            {% endfor %}
                        </div>
                        <div class="col-md-6">
                            <div class="form-check mt-4 pt-3">
                                {{ form.es_supervisor(class="form-check-input") }}
                                {{ form.es_supervisor.label(class="form-check-label") }}
                            </div>
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            {{ form.username.label(class="form-label") }}
                            {{ form.username(class="form-control") }}
                            {% for error in form.username.errors %}
                            <span class="text-danger">{{ error }}</span>
                            {% endfor %}
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            {{ form.password.label(class="form-label") }}
                            {{ form.password(class="form-control") }}
                            {% for error in form.password.errors %}
                            <span class="text-danger">{{ error }}</span>
                            {% endfor %}
                        </div>
                        <div class="col-md-6">
                            {{ form.password2.label(class="form-label") }}
                            {{ form.password2(class="form-control") }}
                            {% for error in form.password2.errors %}
                            <span class="text-danger">{{ error }}</span>
                            {% endfor %}
                        </div>
                    </div>
                    
                    <link rel="stylesheet" href="{{ url_for('static', filename='css/empleados.css') }}">
                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                        {{ form.submit(class="btn btn-navy me-2") }}
                        <a href="{{ url_for('empleados.list_empleados') }}" class="btn btn-cancel-red">
                            <i class="bi bi-x-lg"></i> Cancelar
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
document.getElementById('consultar-curp').addEventListener('click', function() {
    const curp = document.getElementById('curp-input').value;
    if (curp.length === 18) {
        fetch('{{ url_for("empleados.consultar_curp_endpoint") }}', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ curp: curp })
        })
        .then(response => response.json())
        .then(data => {
            if (data.error) {
                alert(data.error);
            } else {
                document.getElementById('nombre-input').value = data.nombre || '';
                document.getElementById('apellido-paterno-input').value = data.apellido_paterno || '';
                document.getElementById('apellido-materno-input').value = data.apellido_materno || '';
                if (data.fecha_nacimiento) {
                    document.getElementById('fecha-nacimiento-input').value = data.fecha_nacimiento;
                }
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Error al consultar la CURP');
        });
    } else {
        alert('La CURP debe tener 18 caracteres');
    }
});
</script>
{% endblock %}